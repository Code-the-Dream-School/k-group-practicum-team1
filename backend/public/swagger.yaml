openapi: 3.0.1
info:
  title: CTD AutoLoan API V1
  description: API for AutoLoan app
  version: "1.0.0"

servers:
  - url: http://localhost:3000/api/v1
    description: Local server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        first_name:
          type: string
          example: John
        last_name:
          type: string
          example: Doe
        email:
          type: string
          format: email
          example: john.doe@example.com
        phone_number:
          type: string
          example: "1234567890"
        role:
          type: string
          enum: [customer, loan_officer, underwriter]
          example: customer
        created_at:
          type: string
          format: date-time
          description: Automatically set by Rails
          example: "2026-01-09T22:17:21.638Z"
          readOnly: true
        updated_at:
          type: string
          format: date-time
          description: Automatically updated by Rails
          example: "2026-01-09T22:17:21.638Z"
          readOnly: true
      required:
        - first_name
        - last_name
        - email
        - phone_number
        - role

    RegistrationRequest:
      type: object
      properties:
        user:
          type: object
          properties:
            first_name:
              type: string
              example: John
            last_name:
              type: string
              example: Doe
            email:
              type: string
              format: email
              example: john.doe@example.com
            phone_number:
              type: string
              example: "1234567890"
            password:
              type: string
              example: Password123!
            password_confirmation:
              type: string
              example: Password123!
            role:
              type: string
              enum: [ customer, loan_officer, underwriter ]
              example: customer
          required:
            - first_name
            - last_name
            - email
            - phone_number
            - password
            - password_confirmation

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: john.doe@example.com
        password:
          type: string
          example: Password123!
      required:
        - email
        - password

    AuthResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: '#/components/schemas/User'

paths:
  # ------------------------
  # Registration
  # ------------------------
  /signup:
    post:
      summary: Register a new user
      description: Register a new user (customer, loan_officer, underwriter)
      tags:
        - Users, Registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistrationRequest'
      responses:
        '201':
          description: User successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          description: Validation errors

  # ------------------------
  # Sessions (Login / Logout)
  # ------------------------
  /sessions:
    post:
      summary: Login user
      tags:
        - Sessions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Logged in successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials

    delete:
      summary: Logout current user
      tags:
        - Sessions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              example: {}
      responses:
        '204':
          description: Logged out successfully
        '401':
          description: Unauthorized

  # ------------------------
  # Current User Info
  # ------------------------
  /me:
    get:
      summary: Get current logged-in user
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized

  # ------------------------
  # Users CRUD
  # ------------------------
  /users:
    get:
      summary: List all users (loan officer/underwriter only)
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized

  /users/{id}:
    get:
      summary: Get user by ID
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '404':
          description: User not found

    patch:
      summary: Update user by ID
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  $ref: '#/components/schemas/User'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
        '422':
          description: Validation errors

    delete:
      summary: Delete user by ID
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: User deleted
        '401':
          description: Unauthorized
        '404':
          description: User not found
